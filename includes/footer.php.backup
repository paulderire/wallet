      </main>
      <footer class="site-footer">
        <div class="container">
          <small>Wallet App </small>
        </div>
      </footer>
    </div>
  </div>
  <script>
    // small helper: confirm on destructive actions (if you wire them later)
    document.addEventListener('click', function(e){
      if (e.target.matches('[data-confirm]')){
        if (!confirm(e.target.getAttribute('data-confirm'))) e.preventDefault();
      }
    });
    // Mobile sidebar toggle (respects no-sidebar)
    (function(){
      var toggle = document.getElementById('menu-toggle');
      var sidebar = document.getElementById('app-sidebar');
      var body = document.body;
      if (!toggle || !sidebar) return;
      if (body.classList.contains('no-sidebar')) {
        sidebar.style.display = 'none';
        return;
      }
      // Toggle behavior varies by viewport width
      function isMobile() { return window.matchMedia('(max-width:900px)').matches; }
      toggle.setAttribute('aria-expanded', 'false');
      toggle.addEventListener('click', function(e){
        e.stopPropagation();
        if (isMobile()) {
          // mobile overlay
          if (sidebar.style.display === 'block'){
            sidebar.style.display = '';
            body.classList.remove('mobile-sidebar-open');
            toggle.setAttribute('aria-expanded','false');
          } else {
            sidebar.style.display = 'block';
            body.classList.add('mobile-sidebar-open');
            toggle.setAttribute('aria-expanded','true');
          }
        } else {
          // desktop collapse/expand
          var isCollapsed = body.classList.toggle('sidebar-collapsed');
          toggle.setAttribute('aria-expanded', isCollapsed ? 'false' : 'true');
        }
      });
      // on resize, ensure overlay closed and aria reflects state
      window.addEventListener('resize', function(){
        if (!isMobile()){
          sidebar.style.display = '';
          body.classList.remove('mobile-sidebar-open');
        } else {
          // if mobile and body has sidebar-collapsed remove it to avoid layout glitches
          body.classList.remove('sidebar-collapsed');
        }
      });
      // clicking outside sidebar closes it
      document.addEventListener('click', function(e){
        if (!body.classList.contains('mobile-sidebar-open')) return;
        if (!sidebar.contains(e.target) && e.target !== toggle){
          sidebar.style.display = '';
          body.classList.remove('mobile-sidebar-open');
        }
      });
    })();

    // Theme toggle: persist in localStorage and apply CSS variables
    (function(){
      var btn = document.getElementById('theme-toggle');
      var body = document.body;
      function applyTheme(theme){
        if (theme === 'light') body.classList.add('theme-light');
        else body.classList.remove('theme-light');
      }
      // init: prefer localStorage, then OS preference
      var stored = null;
      try { stored = localStorage.getItem('wc_theme'); } catch(e){}
      if (stored) applyTheme(stored);
      else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) applyTheme('light');

      if (btn) btn.addEventListener('click', function(){
        var isLight = body.classList.toggle('theme-light');
        try { localStorage.setItem('wc_theme', isLight ? 'light' : 'dark'); } catch(e){}
      });
    })();

    // Simple modal helper (reusable popup)
    (function(){
      // Modal markup is intentionally class-driven so styles come from CSS (theme-aware)
      var modalHtml = '<div id="wc-modal" class="wc-modal" style="display:none">\n'+
                      '<div class="wc-modal-backdrop"></div>\n'+
                      '<div class="wc-modal-body"></div>\n'+
                      '</div>';
      document.body.insertAdjacentHTML('beforeend', modalHtml);
      var modal = document.getElementById('wc-modal');
      var body = document.body;
      function openModal(html){
        modal.querySelector('.wc-modal-body').innerHTML = html + '<div style="text-align:right;margin-top:12px"><button id="wc-close" class="button secondary">Close</button></div>';
        modal.style.display = 'flex';
        document.getElementById('wc-close').addEventListener('click', closeModal);
      }
      function closeModal(){ modal.style.display='none'; modal.querySelector('.wc-modal-body').innerHTML=''; }
      window.WCModal = { open: openModal, close: closeModal };
      // close when clicking backdrop
      modal.addEventListener('click', function(e){ if (e.target.classList.contains('wc-modal-backdrop')) closeModal(); });
    })();

    // Header dropdowns: notifications, messages, profile
    (function(){
      function setupToggle(btnId, panelId){
        var btn = document.getElementById(btnId);
        var panel = document.getElementById(panelId);
        if (!btn || !panel) return;

        // stop clicks inside panel from bubbling to document
        panel.addEventListener('click', function(e){ e.stopPropagation(); });

        btn.addEventListener('click', function(e){
          e.stopPropagation();
          var isOpen = panel.classList.contains('open');
          // close other panels
          document.querySelectorAll('.dropdown-panel.open').forEach(function(p){ if (p !== panel) p.classList.remove('open'); });
          if (!isOpen) panel.classList.add('open');
          else panel.classList.remove('open');
        });
      }

  setupToggle('notif-btn','notif-panel');
  setupToggle('msg-btn','msg-panel');
  setupToggle('profile-btn','profile-panel');

      // click anywhere to close open panels
      document.addEventListener('click', function(){
        document.querySelectorAll('.dropdown-panel.open').forEach(function(p){ p.classList.remove('open') });
      });

      // ESC to close
      document.addEventListener('keydown', function(e){
        if (e.key === 'Escape') document.querySelectorAll('.dropdown-panel.open').forEach(function(p){ p.classList.remove('open') });
      });
    })();

    // Currency switcher handling (header)
    (function(){
      var switcher = document.getElementById('currency-switcher');
      var panel = document.getElementById('currency-panel');
      if (!switcher || !panel) return;

      // persist target currency
      var targetSelect = document.getElementById('currency-target');
      try { var stored = localStorage.getItem('wc_currency_target'); if (stored) targetSelect.value = stored; } catch(e){}

      function closeCurrencyPanel(){ panel.style.display='none'; }
      function openCurrencyPanel(){ panel.style.display='block'; }

      switcher.addEventListener('click', function(e){ e.stopPropagation(); if (panel.style.display === 'block') closeCurrencyPanel(); else openCurrencyPanel(); });
      panel.addEventListener('click', function(e){ e.stopPropagation(); });

      document.addEventListener('click', function(){ if (panel.style.display === 'block') closeCurrencyPanel(); });

      // convert all visible amounts: elements with data-currency and data-amount attributes
      document.getElementById('currency-convert-visible').addEventListener('click', function(){
        var target = targetSelect.value || 'RWF';
        try { localStorage.setItem('wc_currency_target', target); } catch(e){}
        // find elements
        var nodes = document.querySelectorAll('[data-currency][data-amount]');
        nodes.forEach(function(n){
          var base = n.getAttribute('data-currency') || 'USD';
          var amt = parseFloat(n.getAttribute('data-amount')) || parseFloat(n.textContent.replace(/[^0-9\.\-]/g,'')) || 0;
          // call server to convert
            fetch('/MY%20CASH/includes/exchange_ajax.php?base='+encodeURIComponent(base)+'&target='+encodeURIComponent(target)+'&amount='+encodeURIComponent(amt)).then(function(r){ return r.json(); }).then(function(j){
            if (j && j.ok){
              var out = j.converted;
              // format roughly
              n.setAttribute('data-original', amt);
              n.setAttribute('data-original-currency', base);
              n.setAttribute('data-currency', target);
              n.setAttribute('data-amount', out);
              n.textContent = (target === 'RWF' ? new Intl.NumberFormat('en-US').format(out.toFixed(0)) + ' RWF' : parseFloat(out).toFixed(2) + ' USD');
            }
          }).catch(function(){ /* ignore */ });
        });
      });

      // quick convert
      document.getElementById('currency-quick-convert').addEventListener('click', function(){
        var amountField = document.getElementById('currency-quick-amount');
        var tgt = targetSelect.value || 'RWF';
        var amt = parseFloat(amountField.value) || 0;
  fetch('/MY%20CASH/includes/exchange_ajax.php?base=USD&target='+encodeURIComponent(tgt)+'&amount='+encodeURIComponent(amt)).then(function(r){return r.json();}).then(function(j){
          var res = document.getElementById('currency-quick-result');
          if (j && j.ok){
            var formatted = (j.target === 'RWF') ? new Intl.NumberFormat('en-US').format(j.converted.toFixed(0)) + ' RWF' : parseFloat(j.converted).toFixed(2) + ' USD';
            res.textContent = 'Result: ' + formatted + ' (rate: ' + j.rate + ')';
          } else res.textContent = 'Conversion failed';
        }).catch(function(){ document.getElementById('currency-quick-result').textContent = 'Conversion failed'; });
      });
    })();
    
      // Floating AI side-chat widget
        (function(){
          // create button markup
          var aiBtn = document.createElement('button');
          aiBtn.id = 'wc-ai-btn';
          aiBtn.title = 'AI Assistant';
          aiBtn.className = 'icon-button';
          aiBtn.innerHTML = 'ðŸ¤–';
          document.body.appendChild(aiBtn);

          // create side panel markup
          var panelHtml = ''+
            '<div id="wc-ai-panel" class="wc-ai-panel" style="display:none">'+
              '<div class="ai-header">'+
                '<strong>Assistant</strong>'+
                '<button class="ai-close" title="Close">âœ•</button>'+
              '</div>'+
              '<div class="ai-messages" role="log" aria-live="polite"></div>'+
              '<form class="ai-form">'+
                '<input class="ai-input" name="message" placeholder="Ask something..." autocomplete="off">'+
                '<button class="ai-send" type="submit">Send</button>'+
              '</form>'+
            '</div>';
          document.body.insertAdjacentHTML('beforeend', panelHtml);

          // styles for button and panel
            var s = document.createElement('style');
            s.textContent = '\n#wc-ai-btn{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:999px;background:var(--button-bg);color:var(--button-text);box-shadow:0 8px 24px var(--overlay-shadow);display:flex;align-items:center;justify-content:center;z-index:2001;border:0;cursor:pointer;font-size:22px}\n#wc-ai-btn:hover{transform:translateY(-3px);transition:transform .12s ease}\n'+
            '#wc-ai-panel{position:fixed;right:20px;bottom:90px;width:360px;height:460px;border-radius:10px;background:var(--panel-bg, var(--bg));color:var(--text);box-shadow:0 12px 40px var(--overlay-shadow);z-index:2002;display:flex;flex-direction:column;overflow:hidden;border:1px solid var(--border-weak)}\n'+
            '.wc-ai-panel .ai-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border-weak);background:linear-gradient(180deg, rgba(var(--card-text-rgb),0.02), transparent)}\n'+
            '.wc-ai-panel .ai-messages{flex:1;padding:12px;overflow:auto;font-size:14px;display:flex;flex-direction:column;gap:8px}\n'+
            '.wc-ai-panel .ai-msg{max-width:86%;padding:8px 10px;border-radius:8px;background:var(--card-bg-solid)}\n'+
            '.wc-ai-panel .ai-user{align-self:flex-end;background:var(--button-bg);color:var(--button-text)}\n'+
            '.wc-ai-panel .ai-bot{align-self:flex-start;background:var(--muted-color)}\n'+
            '.wc-ai-panel .ai-form{display:flex;border-top:1px solid var(--border-weak);padding:8px}'+
            '.wc-ai-panel .ai-input{flex:1;padding:8px;border-radius:6px;border:1px solid var(--border-weak);margin-right:8px;background:transparent;color:inherit}'+
            '.wc-ai-panel .ai-send{padding:8px 10px;border-radius:6px;border:0;background:var(--button-bg);color:var(--button-text);cursor:pointer}'+
            '.wc-ai-panel .ai-typing{opacity:0.7;font-style:italic}'+
            '\n';
            document.head.appendChild(s);

          var panel = document.getElementById('wc-ai-panel');
          var messages = panel.querySelector('.ai-messages');
          var form = panel.querySelector('.ai-form');
          var input = panel.querySelector('.ai-input');

          function escapeHtml(str){ return String(str).replace(/[&<>]/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;'}[c]; }); }

          function appendMessage(kind, text){
            var d = document.createElement('div'); d.className = 'ai-msg ' + (kind==='user' ? 'ai-user' : 'ai-bot');
            d.innerHTML = '<div class="ai-text">'+escapeHtml(text)+'</div>';
            messages.appendChild(d);
            messages.scrollTop = messages.scrollHeight;
          }

          // toggle panel
          function togglePanel(){
            if (!panel) return;
            if (panel.style.display === 'none' || panel.style.display === ''){ panel.style.display = 'flex'; setTimeout(function(){ input.focus(); },120); }
            else panel.style.display = 'none';
          }

          aiBtn.addEventListener('click', function(){ togglePanel(); });

          panel.querySelector('.ai-close').addEventListener('click', function(){ panel.style.display='none'; });

          // submit handler: POST JSON to ai widget endpoint
          form.addEventListener('submit', function(e){
            e.preventDefault();
            var text = input.value.trim(); if (!text) return;
            appendMessage('user', text);
            input.value = '';
            input.disabled = true;
            // typing indicator
            var typing = document.createElement('div'); typing.className = 'ai-msg ai-bot ai-typing'; typing.innerHTML = '<div class="ai-text">Thinking...</div>'; messages.appendChild(typing); messages.scrollTop = messages.scrollHeight;

            fetch('/MY%20CASH/pages/ai.php?widget=1', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: text })
            }).then(function(r){ return r.json(); }).then(function(j){
              typing.remove();
              if (j && j.reply) appendMessage('bot', j.reply);
              else if (j && j.error) appendMessage('bot', j.error);
              else appendMessage('bot', 'No response from assistant.');
            }).catch(function(){ typing.remove(); appendMessage('bot', 'Error contacting assistant.'); }).finally(function(){ input.disabled = false; input.focus(); });
          });
        })();
  </script>
</body>
</html>
<?php
// flush any output buffer started in header to ensure output is sent
if (ob_get_level()) ob_end_flush();
?>
